# FocusGarden 仕様書（Full Version）

## コンセプト
**集中するためのアプリ + 普通にゲームとしても楽しい植物育成**

- メイン目的: フォーカスセッション中に植物が育つ
- サブ目的: リアルな世話、コレクション、育成の楽しさ
- 世話の手間は最小限、観察と判断がメイン

---

## 用語

### 基本用語
- **植物種（Species）**: 植物の種類（例: サボテン、多肉植物など）
- **個体（Plant）**: 実際に育てている植物の1つ
- **育成枠（Slot）**: 同時に育てられる植物の枠（初期3枠）
- **成長ポイント（GP）**: 成長進行度。10分で1GP増える
- **フォーカスセッション（Focus Session）**: 集中時間。この間だけ植物が育つ
- **完走**: セッションのタイマーが0まで到達すること
- **中断**: セッション途中で終了（アプリ離脱・戻る・中断ボタン等）

### ガチャ・コレクション
- **種（Seed）**: ガチャで入手する植物の種
- **レア度**: Common（普通）/ Rare（レア）/ Epic（激レア）
- **図鑑（Collection）**: 入手した植物種を記録

### 世話関連
- **水やり**: 植物の水分状態を維持
- **肥料**: 成長速度を一時的にブースト
- **病気**: 低確率で発生、放置すると枯れる
- **枯死**: 適切な世話をしないと植物が枯れる

---

## 植物システム

### 植物種（Species）
- **種類数**: 多数の植物種を用意（初期目標: 30-50種類）
- **レア度**: Common / Rare / Epic
- **特徴**:
  - 各種に名前、説明、レア度、成長速度補正などのパラメータ
  - 同じ種でも個体ごとに「突然変異」が発生する可能性

### 育成枠（Slot）
- **初期**: 3枠
- **課金拡張**: 6枠 → 9枠
- **セッション中**: すべての育成中植物が同時に成長

### 植物の状態パラメータ
個体ごとに以下の状態を管理：
- **GP（成長ポイント）**: 0〜120（完全成長まで）
- **水分レベル**: 0〜100（適正範囲: 30〜70）
  - 不足（<30）→ 枯れる危険
  - 過剰（>70）→ 根腐れで枯れる
- **栄養レベル**: 0〜100（肥料で上昇）
- **健康状態**: healthy / sick / dead
- **病気フラグ**: なし / 病気発生中
- **突然変異**: 保持している変異のリスト

---

## 成長システム

### 基本成長ルール
- **成長タイミング**: フォーカスセッション中のみ
- **成長速度**: 10分 = 1 GP（基本）
- **完全成長**: 20時間相当 = 120 GP
- **成長速度補正**:
  - 植物種ごとの補正（例: サボテンは0.8倍、観葉植物は1.2倍）
  - 栄養レベルによるブースト（栄養>50で1.2倍など）

### セッション中の変化
セッション中、全ての育成中植物に対して以下が進行：
- GP増加（時間経過）
- 水分減少（時間経過）
- 栄養減少（時間経過）
- 低確率で病気発生チェック

---

## フォーカスセッション

### セッション選択肢
- 10分 / 25分 / 45分 / 60分

### セッション中の制約
- **世話不可**: 水やり、肥料やり、治療などはできない
- **観察可**: 植物の状態は閲覧可能
- **UIロック**: 育成操作はロックされる

### セッション完了条件
- **完走**: タイマーが0になったら自動完了
  - GP獲得確定
  - 突然変異抽選実施
- **中断**: 途中で終了
  - 経過時間分のGPは獲得（巻き戻しなし）
  - 突然変異抽選なし

---

## 突然変異システム

### 抽選タイミング
- **セッション完走時のみ**実施
- 中断時は抽選なし

### 抽選ルール
- **抽選回数**:
  - 10分: 1回
  - 25分: 2回
  - 45分: 3回
  - 60分: 4回
- **当選確率**: 1回あたり 0.5% (0.005)
- **打ち切り**: 当たりが出たら終了（最大1当選/セッション）

### 変異の種類（5種固定）
1. **variegated（斑入り）**
2. **tint_shift（色味変化）**
3. **leaf_shape（葉形変化）**
4. **dwarf（矮性）**
5. **growth_form（枝ぶり/成長癖）**

### 変異の付与
- 当選時、5種から等確率(20%)で1つ選択
- **すでに保持している変異の場合**: 何も起きない（再抽選なし）
- 変異は個体に永続的に付与

---

## 世話システム

### 設計思想
- **頻繁な操作は不要**: 1日1-2回程度でOK
- **観察→判断**: 植物の状態を見て適切な世話を選ぶ
- **放置ペナルティ**: 長時間放置すると枯れる可能性

### 水やり
- **効果**: 水分レベル +30
- **タイミング**: 水分レベルが30以下になったら
- **ペナルティ**:
  - 水分 < 10: 枯れる危険（警告表示）
  - 水分 > 80: 根腐れの危険（警告表示）

### 肥料
- **効果**:
  - 栄養レベル +50
  - 次のセッションで成長速度1.5倍
- **クールダウン**: 24時間に1回まで

### 病気
- **発生確率**: セッション完走時に2%の確率で発生
- **症状**: 成長速度が0.5倍になる
- **治療**: 薬を使って治療（アイテム消費）
- **放置**: 3日放置すると枯死

### 枯死
以下の条件で植物が枯れる：
- 水分レベルが0で12時間経過
- 水分レベルが100で12時間経過（根腐れ）
- 病気を3日以上放置

---

## ガチャシステム

### 無料ガチャ
- **回数**: 1日5回まで無料
- **リセット**: 毎日0時にリセット
- **排出率**:
  - Common: 70%
  - Rare: 25%
  - Epic: 5%

### 有料ガチャ
- **無料回数消化後**: 有料ガチャに切り替え
- **排出率（確率アップ）**:
  - Common: 50%
  - Rare: 35%
  - Epic: 15%
- **価格**: 1回あたり100円相当（仮）

### 入手した種
- **種の保管**: インベントリに保存
- **育成開始**: 空き枠に種を植える
- **図鑑登録**: 新しい種を入手したら図鑑に自動登録

---

## 図鑑・コレクション

### 図鑑システム
- **登録条件**: 種を1回でも入手したら登録
- **表示内容**:
  - 植物種の名前、画像、説明
  - レア度
  - 入手日時
  - 育成回数

### コレクション要素
- **完成度表示**: 全体の○○%を収集済み
- **レア度別統計**: Common/Rare/Epic ごとの収集率
- **変異コレクション**: 各変異を持った個体の記録

---

## 課金要素

### 育成枠拡張
- **3枠（初期）** → 6枠（600円） → 9枠（1200円）
- **買い切り**: 一度購入すれば永続

### 有料ガチャ
- 1回: 100円
- 10連: 1000円（10%オフ）

### アイテム課金（将来追加予定）
- 肥料パック
- 治療薬パック
- レア種確定ガチャ券

---

## 画面構成

### Home（ホーム）
- 育成枠の一覧表示（3/6/9枠）
- 各枠の植物の状態（GP、水分、栄養、健康状態）
- 世話ボタン（水やり、肥料、治療）
- 空き枠タップ → 種を植える

### Focus（フォーカス）
- セッション時間選択（10/25/45/60分）
- セッション開始ボタン
- セッション中: タイマー、進行状況、育成中植物の状態表示
- 中断ボタン

### Gacha（ガチャ）
- 無料ガチャ（残り回数表示）
- 有料ガチャ
- ガチャ実行 → 結果表示 → 図鑑登録

### Collection（図鑑）
- 植物種の一覧（サムネイル表示）
- 詳細表示（タップで拡大）
- 収集率、統計

### Settings（設定）
- 通知設定
- アカウント管理
- クレジット

---

## データ保存

### MVP（AsyncStorage）
以下のデータをローカルに保存：
- 育成中の植物リスト（個体データ）
- 種のインベントリ
- 図鑑データ
- ガチャ回数（無料残り回数）
- セッション履歴
- 課金情報（枠拡張状態）

### 将来（SQLite or Cloud）
- より高速なクエリ
- クラウド同期
- バックアップ

---

## テスト方針

### 重要ロジックの単体テスト（Jest）
- **成長計算**: GP増加、時間計算
- **突然変異抽選**: 抽選回数、確率、打ち切り、既存変異
- **状態変化**: 水分・栄養の減少、病気発生
- **枯死判定**: 各種枯死条件

### E2Eテスト（将来）
- セッション実行 → 完走 → GP獲得
- ガチャ → 種入手 → 植える → 育成
- 世話 → 状態変化 → 枯死回避

---

## 開発優先度

### Phase 1: 緊急修正
1. モーダルバグ修正
2. セッション自動完了（完了ボタン削除）
3. 全植物同時育成に変更

### Phase 2: 植物種・枠システム
1. 植物種データ（30-50種、レア度）
2. 育成枠UI（3枠表示）
3. 種を植えるフロー
4. 全植物同時成長ロジック

### Phase 3: 世話システム
1. 水分・栄養の時間減少
2. 水やり、肥料機能
3. 病気発生・治療
4. 枯死判定

### Phase 4: ガチャシステム
1. 無料ガチャ（1日5回制限）
2. 有料ガチャ
3. 種インベントリ

### Phase 5: 図鑑・コレクション
1. 図鑑UI
2. 収集率表示

### Phase 6: 課金
1. 枠拡張（3→6→9）
2. Expo IAP連携
3. 課金フロー実装

---

## 備考

### UXの考慮点
- **世話の頻度**: 忙しいユーザーでも1日1回でOK
- **セッション中の楽しみ**: 育成中植物の観察
- **コレクション欲**: ガチャ・図鑑で飽きない
- **集中の邪魔をしない**: 通知は控えめ、世話は簡単

### ゲームバランス
- **無課金でも楽しめる**: 無料ガチャで十分遊べる
- **課金メリット**: 枠拡張、レア確率アップ
- **P2Wにしない**: 課金で強くなりすぎない
